{
  "Name": "CommandInjectionAdvanced",
  "Priority": 101,
  "Statement": {
    "OrStatement": {
      "Statements": [
        {
          "RegexMatchStatement": {
            "RegexString": "(;|\\||&|&&|\\|\\||\\n|%0a|%0d)",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"},
              {"Priority": 1, "Type": "URL_DECODE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "(\\$\\(|`|\\$\\{|\\})",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "(/bin/|/usr/bin/|/sbin/|/usr/sbin/)",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "(cat|ls|pwd|whoami|id|uname|wget|curl|nc|netcat|telnet|ssh|ftp)",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"},
              {"Priority": 1, "Type": "LOWERCASE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "(chmod|chown|kill|pkill|ps|top|ifconfig|iptables|sudo)",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"},
              {"Priority": 1, "Type": "LOWERCASE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "\\$IFS|\\{IFS\\}|\\$\\{IFS\\}",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "/dev/tcp|/dev/udp|>&|<&|>&-",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "(python|perl|ruby|php|node)\\s+(-c|/tmp/|/var/tmp/)",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"},
              {"Priority": 1, "Type": "LOWERCASE"}
            ]
          }
        },
        {
          "RegexMatchStatement": {
            "RegexString": "base64\\s+-d|echo\\s+.*\\||eval\\s+|exec\\s+",
            "FieldToMatch": {"AllQueryArguments": {}},
            "TextTransformations": [
              {"Priority": 0, "Type": "URL_DECODE"},
              {"Priority": 1, "Type": "LOWERCASE"}
            ]
          }
        }
      ]
    }
  },
  "Action": {"Block": {}},
  "VisibilityConfig": {
    "SampledRequestsEnabled": true,
    "CloudWatchMetricsEnabled": true,
    "MetricName": "CommandInjectionAdvanced"
  }
}
